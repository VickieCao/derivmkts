%\VignetteEngine{knitr::knitr} 
%\VignetteIndexEntry{derivmkts}
\documentclass{article}\usepackage[]{graphicx}\usepackage[]{color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
\input{rlistings}
\title{Option Pricing Functions to Accompany \emph{Derivatives Markets}}
\author{Robert McDonald}
\date{\today}

\lstMakeShortInline{|}



\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}
\maketitle
\tableofcontents




\section{Introduction}

This vignette is intended to a road map to the functions in the
functions in the \emph{derivmkts} package, and also to provide some
additional documentation and examples. The package was conceived as a
companion to the book \emph{Derivatives Markets}. There are of course
other option pricing packages for R, but this package primarily uses
function names corresponding to the usage in the book.


\section{Basic European and American Option Pricing}

\subsection{Black-Scholes Pricing of European Options}

The functions |bscall|, |bsput|, and |bsopt| provide basic pricing of
European calls and puts. There are also options with binary payoffs:
cash-or-nothing and asset-or-nothing options. All functions are
vectorized. The function |bsopt| provides option greeks. Here are some
examples:

\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{s} \hlkwb{<-} \hlnum{100}\hlstd{; k} \hlkwb{<-} \hlnum{100}\hlstd{; r} \hlkwb{<-} \hlnum{0.08}\hlstd{; v} \hlkwb{<-} \hlnum{0.30}\hlstd{; tt} \hlkwb{<-} \hlnum{2}\hlstd{; d} \hlkwb{<-} \hlnum{0}
\hlkwd{bscall}\hlstd{(s, k, v, r, tt, d)}
\end{alltt}
\begin{verbatim}
[1] 24.02
\end{verbatim}
\begin{alltt}
\hlkwd{bsput}\hlstd{(s, k, v, r, tt, d)}
\end{alltt}
\begin{verbatim}
[1] 9.239
\end{verbatim}
\begin{alltt}
\hlkwd{bsput}\hlstd{(s,} \hlkwd{c}\hlstd{(}\hlnum{95}\hlstd{,} \hlnum{100}\hlstd{,} \hlnum{105}\hlstd{), v, r, tt, d)}
\end{alltt}
\begin{verbatim}
[1]  7.488  9.239 11.188
\end{verbatim}
\begin{alltt}
\hlkwd{bsopt}\hlstd{(s,} \hlkwd{c}\hlstd{(}\hlnum{95}\hlstd{,} \hlnum{100}\hlstd{,} \hlnum{105}\hlstd{), v, r, tt, d)}\hlopt{$}\hlstd{Call}
\end{alltt}
\begin{verbatim}
           bscall_95 bscall_100 bscall_105
Price      26.533930  24.024675  21.712844
Delta       0.761196   0.722155   0.682341
Gamma       0.007307   0.007905   0.008403
Vega        0.438443   0.474271   0.504179
Rho         0.991713   0.963817   0.930426
Theta      -0.019877  -0.020308  -0.020556
Psi        -1.522392  -1.444310  -1.364683
Elasticity  2.868765   3.005889   3.142570
\end{verbatim}
\end{kframe}
\end{knitrout}

Table \ref{tab:bslist} lists the Black-Scholes related functions in
the package.

\begin{table}[btp]
  \centering
  \begin{tabular}{cp{4in}}
    Function& Description \\ \hline
    bscall & European call\\
    bsput & European put\\ 
    bsopt & European call and put and associated Greeks: delta, gamma,
            vega, theta, rho, psi, and elasticity \\
    assetcall &  Asset-or-nothing call\\
    assetput &  Asset-or-nothing put\\
    cashcall &  Cash-or-nothing call\\ 
    cashput & Cash-or-nothing put
  \end{tabular}
  \caption{Black-Scholes related option pricing functions}
  \label{tab:bslist}
\end{table}


\subsection{Binomial Pricing of European and American Options}

Binomial option pricing provides a way to compute the price of
American options.  There are two functions related to binomial
pricing: 
\begin{description}
\item[binomopt] computes prices of American and European calls and
  puts. Optionally returns the full array of stock prices, selected
  Greeks (delta, gamma, and theta), the option pricing inputs and
  computed parameters, risk-neutral probabilities, and nodes at which
  exercise occurs.
\item[binomplot] displays the asset price
  tree, the corresponding probability of being at each node, and
  whether or not the option is in exercised at each node. This
  function is described in more detail in Section \ref{sec:binomplot}.
\end{description}

Here are examples of pricing, illustrating the default of just
returning the price, and the ability to return the price plus
parameters, as well as the price, the parameters, and various trees:

\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{s} \hlkwb{<-} \hlnum{100}\hlstd{; k} \hlkwb{<-} \hlnum{100}\hlstd{; r} \hlkwb{<-} \hlnum{0.08}\hlstd{; v} \hlkwb{<-} \hlnum{0.30}\hlstd{; tt} \hlkwb{<-} \hlnum{2}\hlstd{; d} \hlkwb{<-} \hlnum{0.03}
\hlkwd{binomopt}\hlstd{(s, k, v, r, tt, d,} \hlkwc{nstep}\hlstd{=}\hlnum{4}\hlstd{)}
\end{alltt}
\begin{verbatim}
price 
20.29 
\end{verbatim}
\begin{alltt}
\hlkwd{binomopt}\hlstd{(s, k, v, r, tt, d,} \hlkwc{nstep}\hlstd{=}\hlnum{4}\hlstd{,} \hlkwc{returnparams}\hlstd{=}\hlnum{TRUE}\hlstd{)}
\end{alltt}
\begin{verbatim}
   price        s        k        v        r       tt        d    nstep 
 20.2884 100.0000 100.0000   0.3000   0.0800   2.0000   0.0300   4.0000 
       p       up       dn        h 
  0.4472   1.2676   0.8293   0.5000 
\end{verbatim}
\begin{alltt}
\hlkwd{binomopt}\hlstd{(s, k, v, r, tt, d,} \hlkwc{nstep}\hlstd{=}\hlnum{4}\hlstd{,} \hlkwc{putopt}\hlstd{=}\hlnum{TRUE}\hlstd{)}
\end{alltt}
\begin{verbatim}
price 
12.37 
\end{verbatim}
\begin{alltt}
\hlkwd{binomopt}\hlstd{(s, k, v, r, tt, d,} \hlkwc{nstep}\hlstd{=}\hlnum{4}\hlstd{,} \hlkwc{returntrees}\hlstd{=}\hlnum{TRUE}\hlstd{,} \hlkwc{putopt}\hlstd{=}\hlnum{TRUE}\hlstd{)}
\end{alltt}
\begin{verbatim}
$price
price 
12.37 

$greeks
    delta     gamma     theta 
-0.354907  0.011314 -0.007918 

$params
       s        k        v        r       tt        d    nstep        p 
100.0000 100.0000   0.3000   0.0800   2.0000   0.0300   4.0000   0.4472 
      up       dn        h 
  1.2676   0.8293   0.5000 

$oppricetree
      [,1]  [,2]   [,3]  [,4]  [,5]
[1,] 12.37  4.15  0.000  0.00  0.00
[2,]  0.00 19.94  7.813  0.00  0.00
[3,]  0.00  0.00 31.220 14.71  0.00
[4,]  0.00  0.00  0.000 42.96 27.69
[5,]  0.00  0.00  0.000  0.00 52.69

$stree
     [,1]   [,2]   [,3]   [,4]   [,5]
[1,]  100 126.76 160.68 203.68 258.19
[2,]    0  82.93 105.13 133.26 168.92
[3,]    0   0.00  68.78  87.19 110.52
[4,]    0   0.00   0.00  57.04  72.31
[5,]    0   0.00   0.00   0.00  47.31

$probtree
     [,1]   [,2]   [,3]    [,4]    [,5]
[1,]    1 0.4472 0.2000 0.08941 0.03998
[2,]    0 0.5528 0.4944 0.33163 0.19772
[3,]    0 0.0000 0.3056 0.41000 0.36667
[4,]    0 0.0000 0.0000 0.16896 0.30221
[5,]    0 0.0000 0.0000 0.00000 0.09341

$exertree
      [,1]  [,2]  [,3]  [,4]  [,5]
[1,] FALSE FALSE FALSE FALSE FALSE
[2,] FALSE FALSE FALSE FALSE FALSE
[3,] FALSE FALSE  TRUE FALSE FALSE
[4,] FALSE FALSE FALSE  TRUE  TRUE
[5,] FALSE FALSE FALSE FALSE  TRUE

$deltatree
        [,1]    [,2]    [,3]    [,4]
[1,] -0.3549 -0.1385  0.0000  0.0000
[2,]  0.0000 -0.6344 -0.3145  0.0000
[3,]  0.0000  0.0000 -0.9232 -0.7140
[4,]  0.0000  0.0000  0.0000 -0.9851

$bondtree
      [,1]  [,2]  [,3]  [,4]
[1,] 47.86 21.71  0.00  0.00
[2,]  0.00 72.55 40.88  0.00
[3,]  0.00  0.00 92.63 76.96
[4,]  0.00  0.00  0.00 96.08
\end{verbatim}
\end{kframe}
\end{knitrout}



\section{Barrier Options}

There are pricing functions for a large number of barrier options: 

\begin{itemize}
\item down-and-in and down-and-out barrier binary options 
\item  up-and-in and up-and-out barrier binary options 
\item  more standard
  down- and up- calls and puts, constructed using the barrier binary
  options
\end{itemize}
Naming for the barrier options generally follows the convention
\begin{verbatim}
[u|d][i|o][call|put]
\end{verbatim}
which means that the option is "up" or "down", "in" or "out", and a
call or put.\footnote{The naming convention here differs from that in
\emph{Derivatives Markets}, in which names are \lstinline{callupin}, callupout,
etc. For consistency, but possibly at the cost of confusion, I have
made both names are available for these functions.}  An up-and-in
call, for example, would be denoted by |uicall|. For binary options,
we add the underlying, which is either the asset or \$1:
cash:

\begin{verbatim}
[asset|cash][u|d][i|o][call|put]
\end{verbatim}


\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{H} \hlkwb{<-} \hlnum{105}
\hlkwd{uicall}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{95}\hlstd{,} \hlnum{100}\hlstd{,} \hlnum{105}\hlstd{), k, v, r, tt, d, H)}
\end{alltt}
\begin{verbatim}
[1] 16.89 19.96 23.22
\end{verbatim}
\begin{alltt}
\hlkwd{bscall}\hlstd{(}\hlkwd{c}\hlstd{(}\hlnum{95}\hlstd{,} \hlnum{100}\hlstd{,} \hlnum{105}\hlstd{), k, v, r, tt, d)}
\end{alltt}
\begin{verbatim}
[1] 16.89 19.96 23.22
\end{verbatim}
\end{kframe}
\end{knitrout}

\section{Option Greeks}

Greeks for Black-Scholes style and barrier options can be computed in
several ways:
\begin{itemize}
\item For European calls and puts, the |bsopt| function produces
  Greeks in addition to prices. 
\item The |greeks| function takes as arguments the name of the pricing
  function and then its inputs.
\item The |greeks2| function takes the function call as an input.
\end{itemize}
Here are illustrations of the two functions using the same parameters:

\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{H} \hlkwb{<-} \hlnum{105}
\hlkwd{greeks}\hlstd{(}\hlkwd{uicall}\hlstd{(s, k, v, r, tt, d, H))}
\end{alltt}
\begin{verbatim}
             uicall
Price      19.95866
Delta       0.63385
Gamma       0.00801
Vega        0.48072
Rho         0.86818
Theta      -0.01418
Psi        -1.26736
Elasticity  3.17582
\end{verbatim}
\begin{alltt}
\hlkwd{greeks2}\hlstd{(uicall,} \hlkwc{s}\hlstd{=s,} \hlkwc{k}\hlstd{=k,} \hlkwc{v}\hlstd{=v,} \hlkwc{r}\hlstd{=r,} \hlkwc{tt}\hlstd{=tt,} \hlkwc{d}\hlstd{=d,} \hlkwc{H}\hlstd{=H)}
\end{alltt}
\begin{verbatim}
             uicall
Price      19.95866
Delta       0.63385
Gamma       0.00801
Vega        0.48072
Rho         0.86818
Theta      -0.01418
Psi        -1.26736
Elasticity  3.17582
\end{verbatim}
\end{kframe}
\end{knitrout}


\section{Jumps and Stochastic Volatility}
\label{sec:jumps}

\section{Asian Options}
 
\section{Illustrative Functions}


Several functions are intended to illustrate some aspects of the
material. 

\subsection{Quincunx or Galton Board}




\subsection{Plotting the Solution to the Binomial Pricing Model}
\label{sec:binomplot}

The |binomplot| function calls |binomopt| to compute the option price
and the various trees, which it then uses in plotting:

The first plot, figure \ref{fig:binomplot1}, is basic:

\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{binomplot}\hlstd{(s, k, v, r, tt, d,} \hlkwc{nstep}\hlstd{=}\hlnum{6}\hlstd{,} \hlkwc{american}\hlstd{=}\hlnum{TRUE}\hlstd{,} \hlkwc{putopt}\hlstd{=}\hlnum{TRUE}\hlstd{)}
\end{alltt}
\end{kframe}\begin{figure}

{\centering \includegraphics[width=3.75in]{figure/binomplot1-1} 

}

\caption{Basic option plot showing stock prices and nodes at which the option is exercised.\label{fig:binomplot1}}\label{fig:binomplot1}
\end{figure}


\end{knitrout}

The second plot, figure \ref{fig:binomplot2}, adds a display of stock
prices and arrows connecting the nodes.

\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{binomplot}\hlstd{(s, k, v, r, tt, d,} \hlkwc{nstep}\hlstd{=}\hlnum{6}\hlstd{,} \hlkwc{american}\hlstd{=}\hlnum{TRUE}\hlstd{,} \hlkwc{putopt}\hlstd{=}\hlnum{TRUE}\hlstd{,}
    \hlkwc{plotvalues}\hlstd{=}\hlnum{TRUE}\hlstd{,} \hlkwc{plotarrows}\hlstd{=}\hlnum{TRUE}\hlstd{)}
\end{alltt}
\end{kframe}\begin{figure}

{\centering \includegraphics[width=3.75in]{figure/binomplot2-1} 

}

\caption{Same plot as Figure \ref{fig:binomplot1} except that values and arrows are added to the plot.\label{fig:binomplot2}}\label{fig:binomplot2}
\end{figure}


\end{knitrout}

Finally, here is a plot for an American call when the dividend yield
is positive and |nstep| has a larger value:

\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{d} \hlkwb{<-} \hlnum{0.06}
\hlkwd{binomplot}\hlstd{(s, k, v, r, tt, d,} \hlkwc{nstep}\hlstd{=}\hlnum{40}\hlstd{,} \hlkwc{american}\hlstd{=}\hlnum{TRUE}\hlstd{)}
\end{alltt}
\end{kframe}\begin{figure}

{\centering \includegraphics[width=3.75in]{figure/binomplot3-1} 

}

\caption{Binomial plot when nstep is 40.\label{fig:binomplot3}}\label{fig:binomplot3}
\end{figure}


\end{knitrout}

Notice that the large value of |nstep| creates a high maximum terminal
stock price, which makes the plot hard to see in the narrow region where
exercise is occurring. We can zoom in on that region by  selecting values for |ylimval|:

\begin{knitrout}\footnotesize
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlstd{d} \hlkwb{<-} \hlnum{0.06}
\hlkwd{binomplot}\hlstd{(s, k, v, r, tt, d,} \hlkwc{nstep}\hlstd{=}\hlnum{40}\hlstd{,} \hlkwc{american}\hlstd{=}\hlnum{TRUE}\hlstd{,} \hlkwc{ylimval}\hlstd{=}\hlkwd{c}\hlstd{(}\hlnum{75}\hlstd{,} \hlnum{225}\hlstd{))}
\end{alltt}
\end{kframe}\begin{figure}

{\centering \includegraphics[width=3.75in]{figure/binomplot4-1} 

}

\caption{Binomial plot when nstep is 40 using the argument ylimval to focus on a subset.\label{fig:binomplot4}}\label{fig:binomplot4}
\end{figure}


\end{knitrout}

\end{document}
